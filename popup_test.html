<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chromium popup blocker repro</title>
</head>
<body>
  <h1>Попапы через DOM append (без клика)</h1>
  <p>
    Эта страница пытается открыть 5 вкладок через создание/append &lt;a target="_blank"&gt; и .click()
    <b>автоматически</b>. В Chromium это обычно блокируется.
  </p>

  <div id="log" style="font-family: ui-monospace, SFMono-Regular, Menlo, monospace;"></div>

  <script>
    const logEl = document.getElementById("log");
    const log = (s) => (logEl.innerHTML += s + "<br>");

    function openViaDomAppend(i) {
      const a = document.createElement("a");
      a.href = "about:blank";
      a.target = "_blank";
      a.rel = "opener"; // явно НЕ noopener, чтобы был opener
      a.textContent = "tab " + i;

      document.body.appendChild(a);

      try {
        a.click(); // synthetic click без user activation → Chromium обычно блокирует
        log("Attempt " + i + ": click() fired");
      } catch (e) {
        log("Attempt " + i + ": exception " + e);
      } finally {
        a.remove();
      }
    }

    // Важно: запуск НЕ по клику, а автоматически
    window.addEventListener("DOMContentLoaded", () => {
      // микрозадержка, чтобы было точно не в жесте пользователя
      setTimeout(() => {
        for (let i = 1; i <= 5; i++) openViaDomAppend(i);
        log("<b>Done.</b> Если Chromium включил блокировку — увидишь иконку blocked popups в адресной строке.");
      }, 300);
    });
  </script>
</body>
</html>
